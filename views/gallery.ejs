<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>Libreria DBA2</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<!-- CSS -->
	<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="css/spring.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="js/prettyPhoto/css/prettyPhoto.css" type="text/css" media="screen" />
	<!--[if IE 6]>
<link rel="stylesheet" type="text/css" media="screen" href="css/ie-hacks.css" />
<script type="text/javascript" src="js/DD_belatedPNG.js"></script>
<script>/* EXAMPLE */ DD_belatedPNG.fix('*');</script>
<![endif]-->
	<!-- ENDS CSS -->
	<!-- JS -->
	<script type="text/javascript" src="js/jquery_1.3.2.js"></script>
	<script type="text/javascript" src="js/jqueryui.js"></script>
	<script type="text/javascript" src="js/easing.js"></script>
	<script type="text/javascript" src="js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="js/prettyPhoto/js/jquery.prettyPhoto.js"></script>
	<script type="text/javascript" src="js/custom.js"></script>
	<!-- ENDS JS -->
	<!-- superfish -->
	<link rel="stylesheet" type="text/css" media="screen" href="css/superfish-custom.css" />
	<script type="text/javascript" src="js/superfish-1.4.8/js/hoverIntent.js"></script>
	<script type="text/javascript" src="js/superfish-1.4.8/js/superfish.js"></script>
	<!-- ENDS superfish -->
	<!-- Cufon -->
	<script src="js/cufon-yui.js" type="text/javascript"></script>
	<script src="js/bebas_400.font.js" type="text/javascript"></script>
	<script type="text/javascript">Cufon.replace('.custom', { fontFamily: 'bebas', hover: true });</script>
	<!-- /Cufon -->
	<!-- Prettyphotos -->
	<script type="text/javascript" charset="utf-8">
		$(document).ready(function () {
			$("a[rel^='prettyPhoto']").prettyPhoto();
		});
	</script>
	<link rel="icon" type="image/x-icon" href="/img/icono.ico">
	<!-- ENDS  Prettyphotos -->
</head>

<body>
	<!-- WRAPPER -->
	<div id="wrapper">
		<!-- navigation -->
		<ul id="nav" class="sf-menu">
			<li class="custom"><a href="/categorias">CATEGORIAS</a></li>
			<li class="custom"><a href="/autores">AUTORES</a></li>
			<li class="custom"><a href="/libros">LIBROS</a></li>
			<li class="custom"><a href="/about">ACERCA</a>
			</li>
		</ul>
		<!-- ENDS navigation -->
		<!-- HEADER -->
		<div id="header"> <a href="index.html"><img src="img/logo3.png" alt="" id="logo" /></a> <img
				src="img/nav-arrow.png" alt="" id="arrow" class="arrow-about" />
			<form action="/buscar-libro" method="post" id="search">
				<p>
					<input type="text" onfocus="this.value=''" onblur="clearInput(this)" name="keyword" id="keyword"
						value="Buscar..." />
				</p>
				<p>
					<input type="submit" id="go" value="" />
				</p>
				<div class="clear"></div>
			</form>
		</div>
		<!-- ENDS HEADER -->
		<!-- MAIN -->
		<div id="main">
			<!-- filter -->
			<ul id="portfolio-filter">
				<li>CATEGORIAS: </li>
				<li><a href="/libros?filtro=todas" <% if (categoria=='todas' ) { %>class = "remarcada"<% } %>>TODAS</a>
				</li>
				<% categorias.forEach(function(row, index, array) { %>
					<li><a href="/libros?filtro=<%= row.id %>" <% if (categoria!='todas' ) { if (categoria==row.id){%>
							class = "remarcada" <%}}%> ><%= row.nombre %></a></li>
					<% }); %>
						<% if (categoria=='busqueda' ){ %>
							<li><a href="/libros" class="remarcada">RESULTADOS BUSQUEDA</li>
							<% }; %>
			</ul>
			<ul id="portfolio-list" class="gallery">
				<li class="cat-agregar"> <a rel="">
						<span onclick="showInsertBook()"></span> <img src="img/addBook.jpg" alt="" /></a> <em style="color:beige;">.</em><em style="font-size:20px; font-weight: bold; margin-bottom: 1em;">Agregar
							libro</em><em style="color:beige;"> .</em><em style="color:beige;">. </em> </li>
				<% results.forEach(function(row, index, array) { %>
					<li class="cat-images"> <a href="img/portadas/<%= (index+1) %>.jpg" rel="prettyPhoto[images]">
							<span></span> <img src="img/portadas/<%= (index+1) %>.jpg" alt="" /></a> <em >
							<%= row.titulo %>
						</em>
						<em>
							<%= new Date(row.fecha).toLocaleDateString('en-us', { weekday:"long", year:"numeric",
								month:"short", day:"numeric"}) %>
						</em><em>
							<%= row.categoria %><em style="font-size:20px; font-weight: bold; margin-bottom: 1em;">
									<%= row.autor %>
								</em>
					</li>
					<% }); %>
			</ul>
			<!-- ENDS thumbs -->
			<!-- pager -->
			<ul class="pager">
				<li><a href="#">link</a></li>
				<li class="active"><a href="#">link</a></li>
				<li><a href="#">link</a></li>
				<li><a href="#">link</a></li>
				<li><a href="#">link</a></li>
				<li><a href="#">link</a></li>
			</ul>
		</div>
	</div>
	<div id="footer">
		<div id="footer-wrapper">
			<div class="footer-bottom">
				<p class="legal">&copy; Copyright 2023</p>
			</div>
		</div>
	</div>
	<div id="hide1">
		<div id="formInsertBook">
			<ul id="portfolio-filter" class="titulo">
				<li>Ingreso de libro <button id="hideButton" onclick="hideInsertBook()">X</button></li>
			</ul>
			<label for="titulo">Titulo:</label>
			<input type="text" name="titulo" id="titulo">
			<label for="fecha_publicacion">Fecha de publicacion</label>
			<input type="date" name="fecha_publicacion" id="fecha_publicacion">
			<label for="categoria">Categoria</label>
			<select name="categoria" id="categoria"></select>
			<label for="autor">Autor</label>
			<select name="autor" id="autor"></select>
			<button id="insertButton" onclick="addBook()"><img src="/img/addIcon.png">INGRESAR LIBRO</button>
		</div>
	</div>
	<div id="hide2">
		<div id="formConfirm">
			<img src="img/ERROR.png" id="imgERROR" style="display:none;" alt="error">
			<img src="img/OK.png" id="imgOK" style="display:none;" alt="">
			<p id="textConfirm"></p>
			<hr>
			<a href="/" class="cerrar">X</a>
		</div>
	</div>
	<script>
		$("#search").submit(function (e) {
			e.preventDefault();
			// fetch('/buscar?keyword='+document.getElementById("keyword").value)
			// 	.then(response => response.json())
			// 	.then(data => {
			// 		console.log(data);
			// 	})
			// 	.catch(error => {
			// 		console.error('Error:', error);
			// 	});
			location.href = "/buscar-libro?keyword=" + document.getElementById("keyword").value;
		});

		function showInsertBook() {
			document.getElementById("hide1").style.display = "flex";
			const select = document.getElementById('categoria');
			const selectAutor = document.getElementById('autor');
			select.innerHTML = "";
			selectAutor.innerHTML = "";
			fetch('/obtener-categorias')
				.then(response => response.json())
				.then(data => {
					// Itera sobre cada categoría y crea una opción para el select
					data.forEach(categoria => {
						const option = document.createElement('option');
						option.value = categoria.id;
						option.textContent = categoria.nombre;
						select.appendChild(option);
					});
					fetch('/obtener-autores')
						.then(response2 => response2.json())
						.then(data2 => {
							// Itera sobre cada categoría y crea una opción para el select
							data2.forEach(autor => {
								const option = document.createElement('option');
								option.value = autor.id;
								option.textContent = autor.nombre;
								selectAutor.appendChild(option);
							});
						})
						.catch(error2 => {
							console.error('Error:', error2);
						});
				})
				.catch(error => {
					console.error('Error:', error);
				});
		}
		function showConfirm(status) {
			document.getElementById("hide2").style.display = "flex";
			if (status == 200) {
				document.getElementById("imgOK").style.display = "";
				document.getElementById("textConfirm").textContent = "LIBRO INGRESADO EXITOSAMENTE";
				document.getElementById("textConfirm").style.color = "green";
			} else {
				document.getElementById("imgERROR").style.display = "";
				document.getElementById("textConfirm").textContent = "OCURRIO UN ERROR Y NO SE INGRESO EL LIBRO";
				document.getElementById("textConfirm").style.color = "red";
			}
		}

		function hideInsertBook() {
			document.getElementById("hide1").style.display = "none";
		}

		function addBook() {
			var titulo = document.getElementById("titulo").value;
			var fecha_publicacion = document.getElementById("fecha_publicacion").value;
			var categoria_id = document.getElementById("categoria").value;
			var autor_id = document.getElementById("autor").value;
			var data = { titulo, fecha_publicacion, categoria_id, autor_id };

			fetch("/insertar-libro", {
				method: "POST", // *GET, POST, PUT, DELETE, etc.
				mode: "cors", // no-cors, *cors, same-origin
				cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
				credentials: "same-origin", // include, *same-origin, omit
				headers: {
					"Content-Type": "application/json",
					// 'Content-Type': 'application/x-www-form-urlencoded',
				},
				redirect: "follow", // manual, *follow, error
				referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
				body: JSON.stringify(data), // body data type must match "Content-Type" header
			}).then((response) => {
				showConfirm(response.status);
			});
		}
	</script>
</body>

</html>